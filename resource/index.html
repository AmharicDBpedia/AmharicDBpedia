<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Amharic DBpedia Resource</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 40px; }
    h1 { font-size: 24px; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background-color: #f0f0f0; }
    a { color: blue; text-decoration: none; }
  </style>
</head>
<body>

<h1 id="title">Loading...</h1>
<p id="resourceLink"></p>

<table id="results">
  <thead>
    <tr><th>Predicate</th><th>Object</th></tr>
  </thead>
  <tbody>
    <tr><td colspan="2">Loading data...</td></tr>
  </tbody>
</table>

<script>
    let resourceURI;
    
    if (window.location.hash) {
      const originalPath = decodeURIComponent(window.location.hash.slice(1));
      resourceURI = "http://am.dbpedia.org" + originalPath;
    } else {
      resourceURI = window.location.href;
    }

  const endpoint = 'https://am.dbpedia.data.dice-research.org/sparql';

  // Show the title and URI
  document.getElementById("title").textContent = decodeURIComponent(resourceURI.split('/').pop().replace(/_/g, ' '));
  document.getElementById("resourceLink").innerHTML =
    `Resource URI: <a href="${resourceURI}" target="_blank">${resourceURI}</a>`;

  // Build and send SPARQL query
  const query = `
    SELECT DISTINCT ?predicate ?object WHERE {
      <${resourceURI}> ?predicate ?object.
    } LIMIT 100
  `;

  const url = endpoint + '?query=' + encodeURIComponent(query) + '&format=application/sparql-results+json';
  console.log("url is ", url)

  fetch(url)
    .then(res => res.json())
    .then(data => {
      const tbody = document.querySelector("#results tbody");
      tbody.innerHTML = "";

      if (data.results.bindings.length === 0) {
        tbody.innerHTML = `<tr><td colspan="2">No data found for this resource.</td></tr>`;
        return;
      }

      data.results.bindings.forEach(row => {
        const pred = row.predicate.value;
        const obj = row.object.value;
        const objIsURI = row.object.type === "uri";

        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td><a href="${pred}" target="_blank">${pred}</a></td>
          <td>${objIsURI ? `<a href="${obj}" target="_blank">${obj}</a>` : obj}</td>
        `;
        tbody.appendChild(tr);
      });
    })
    .catch(err => {
      document.querySelector("#results tbody").innerHTML = `<tr><td colspan="2">Error loading data</td></tr>`;
      console.error(err);
    });
</script>

</body>
</html>
